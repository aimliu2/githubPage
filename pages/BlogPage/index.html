---
layout: danfojs
title: JS Dataframe Blog
---
<!-- -------------------------------- html --------------------------------- -->
<div class="row">
    <div class="col-12">
    <div id="main-card" class="card mx-auto mt-4" style="width: 20rem;">
		<div id="dropzone" class="text-center card-img-top">
			<img src="{{site.baseurl}}/images/cloud-up-arrow-svgrepo-com.svg" class="upload-icon" />
			<input type="file" accept=".csv" class="upload-input" />
		</div>
        <div class="card-body">
            <div class="col text-center">
            <h1>Drop CSV to upload</h1>
            <button type="button" id="btn-upload" class="btn btn-primary" name="uploadbutton">Parse CSV</button>
            </div>
		</div>
    </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div id="table_data"></div>
    </div>
</div>
<!-- ----------------------------- Javascript ------------------------------ -->
<script>
const dropzone = document.querySelector('#dropzone');
const fileInput = document.querySelector('.upload-input');
const btnUpload = document.querySelector('#btn-upload');

// fn update button text
const updateButton = (name) => {
    txt = "Parse "+name
    btnUpload.innerText = txt
}

// fn update svg sicon
const updateSVG = () => {
    dropzone.querySelector('.upload-icon').src = "{{site.baseurl}}/images/file-info-alt-svgrepo-com.svg";
}

// fn handle csv
const handleCSV = (csvFile) => {
    dfd.readCSV(csvFile).then(df => {
        // shown in console 
        // group data
        let c1 = "Sessions"
        let c2 = "Time(sec)"
        let c3 = "Time(sec)/Sessions"
        let grp = df.groupby(["WebSite"])
        let gs = grp.col([c1]).sum().asType(c1+"_sum", "float32")
        let gt = grp.col([c2]).sum().asType(c2+"_sum", "float32")

        let ts_value = gt[c2+"_sum"].div(gs[c1+"_sum"]).round(2)
        // ts_value.print()
        let merge_df = dfd.merge({ left: gt, right: gs, on: ["WebSite"], how: "left"})
        merge_df.addColumn(c3, ts_value, { inplace: true });
        merge_df.sortValues(c3, { ascending: false, inplace: true })
        merge_df.plot("table_data").table()

    }).catch(err=>{alert(err);})
}

// bind change to action
fileInput.addEventListener('change', (e) => {
    e.preventDefault();
    // get file
    let file = e.target.files[0]
    // Display filename
    updateButton(file.name)
    updateSVG()
    // handle CSV
    handleCSV(file);
});

// bind click to upload
dropzone.addEventListener('click', (e) => {
    fileInput.click()
})


</script>
<!-- --------------------------------- CSS --------------------------------- -->
<style>
@import url(https://fonts.googleapis.com/css?family=Open+Sans:700,300);

.frame {
	font-family: "Open Sans", Helvetica, sans-serif;
}

.box {
	/* position: absolute; */
	/* top: 20vh; */
	/* left: 50%; */
	transform: translate(-50%, -50%);
	width: 300px;
	height: 260px;
	border-radius: 3px;
	box-shadow: 8px 10px 15px 0 rgba(0, 0, 0, 0.2);
	background: #fff;
	/* display: flex; */
	/* align-items: center; */
	/* justify-content: space-evenly; */
	/* flex-direction: column; */
}

h1 {
	font-size: 16px;
	font-weight: 300;
	color: #666;
}

.upload-icon {
	margin: 10px 2px 2px 2px;
    width : 60px;
    height : auto
}

.upload-input {
	visibility: hidden;
}

.btn-upload {
	display: block;
	width: 50px;
	height: 40px;
	background: darkmagenta;
	color: #fff;
	border-radius: 3px;
	border: 0;
	box-shadow: 0 3px 0 0 hotpink;
	transition: all 0.3s ease-in-out;
	font-size: 14px;
}

.btn-upload:hover {
	background: rebeccapurple;
	box-shadow: 0 3px 0 0 deeppink;
}

</style>